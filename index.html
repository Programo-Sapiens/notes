<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Structured Notes App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    #container { display: flex; gap: 20px; }
    .panel { width: 30%; border: 1px solid #ccc; padding: 10px; border-radius: 5px; }
    .panel h2 { font-size: 1.2rem; }
    textarea, input[type="text"] { width: 100%; margin-bottom: 10px; padding: 5px; }
    img { max-width: 100%; margin-top: 10px; }
    button { padding: 5px 10px; margin-right: 5px; }
  </style>
</head>
<body>
  <h1>Structured Notes App</h1>
  <div id="container">
    <div class="panel">
      <h2>Books</h2>
      <input type="text" id="bookName" placeholder="Book Name">
      <button onclick="addBook()">Add Book</button>
      <ul id="bookList"></ul>
    </div>
    <div class="panel">
      <h2>Chapters</h2>
      <input type="text" id="chapterName" placeholder="Chapter Name">
      <button onclick="addChapter()">Add Chapter</button>
      <ul id="chapterList"></ul>
    </div>
    <div class="panel">
      <h2>Sections</h2>
      <input type="text" id="sectionName" placeholder="Section Name">
      <button onclick="addSection()">Add Section</button>
      <ul id="sectionList"></ul>
    </div>
  </div>
  <div class="panel" style="margin-top: 20px;">
    <h2>Notes</h2>
    <textarea id="noteText" placeholder="Write your note here..."></textarea>
    <input type="file" id="imageInput">
    <button onclick="addNote()">Add Note</button>
    <div id="notes"></div>
  </div>

  <script>
    let books = [];
    let currentBookIndex = null;
    let currentChapterIndex = null;
    let currentSectionIndex = null;

    const bookList = document.getElementById('bookList');
    const chapterList = document.getElementById('chapterList');
    const sectionList = document.getElementById('sectionList');
    const notesDiv = document.getElementById('notes');

    const saveData = () => localStorage.setItem('notesAppData', JSON.stringify(books));
    const loadData = () => {
      const data = JSON.parse(localStorage.getItem('notesAppData'));
      if (data) books = data;
      renderBooks();
    };

    const renderBooks = () => {
      bookList.innerHTML = '';
      books.forEach((book, index) => {
        const li = document.createElement('li');
        li.textContent = book.name;
        li.onclick = () => selectBook(index);
        bookList.appendChild(li);
      });
    };

    const renderChapters = () => {
      chapterList.innerHTML = '';
      if (currentBookIndex === null) return;
      books[currentBookIndex].chapters.forEach((chapter, index) => {
        const li = document.createElement('li');
        li.textContent = chapter.name;
        li.onclick = () => selectChapter(index);
        chapterList.appendChild(li);
      });
    };

    const renderSections = () => {
      sectionList.innerHTML = '';
      if (currentChapterIndex === null) return;
      books[currentBookIndex].chapters[currentChapterIndex].sections.forEach((section, index) => {
        const li = document.createElement('li');
        li.textContent = section.name;
        li.onclick = () => selectSection(index);
        sectionList.appendChild(li);
      });
    };

    const renderNotes = () => {
      notesDiv.innerHTML = '';
      if (currentSectionIndex === null) return;
      books[currentBookIndex].chapters[currentChapterIndex].sections[currentSectionIndex].notes.forEach(note => {
        const div = document.createElement('div');
        div.className = 'note';
        div.innerHTML = `<p>${note.text}</p>${note.image ? `<img src="${note.image}" alt="Note Image">` : ''}`;
        notesDiv.appendChild(div);
      });
    };

    const addBook = () => {
      const name = document.getElementById('bookName').value.trim();
      if (!name) return alert('Book name is required!');
      books.push({ name, chapters: [] });
      saveData();
      renderBooks();
    };

    const addChapter = () => {
      if (currentBookIndex === null) return alert('Select a book first!');
      const name = document.getElementById('chapterName').value.trim();
      if (!name) return alert('Chapter name is required!');
      books[currentBookIndex].chapters.push({ name, sections: [] });
      saveData();
      renderChapters();
    };

    const addSection = () => {
      if (currentChapterIndex === null) return alert('Select a chapter first!');
      const name = document.getElementById('sectionName').value.trim();
      if (!name) return alert('Section name is required!');
      books[currentBookIndex].chapters[currentChapterIndex].sections.push({ name, notes: [] });
      saveData();
      renderSections();
    };

    const addNote = () => {
      if (currentSectionIndex === null) return alert('Select a section first!');
      const text = document.getElementById('noteText').value.trim();
      const imageInput = document.getElementById('imageInput');
      const file = imageInput.files[0];
      const reader = new FileReader();

      reader.onload = () => {
        const image = file ? reader.result : null;
        books[currentBookIndex].chapters[currentChapterIndex].sections[currentSectionIndex].notes.push({ text, image });
        saveData();
        renderNotes();
        document.getElementById('noteText').value = '';
        imageInput.value = '';
      };

      if (file) reader.readAsDataURL(file);
      else reader.onload();
    };

    const selectBook = index => {
      currentBookIndex = index;
      currentChapterIndex = null;
      currentSectionIndex = null;
      renderChapters();
      renderSections();
      renderNotes();
    };

    const selectChapter = index => {
      currentChapterIndex = index;
      currentSectionIndex = null;
      renderSections();
      renderNotes();
    };

    const selectSection = index => {
      currentSectionIndex = index;
      renderNotes();
    };

    loadData();
  </script>
</body>
</html>
